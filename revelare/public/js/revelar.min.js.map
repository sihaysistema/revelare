{"version":3,"file":"revelar.min.js","sources":["../../../../apps/revelare/revelare/public/js/revelar.js"],"sourcesContent":["// Copyright (c) 2018, Si Hay Sistema (SHS) and contributors\n// For license information, please see license.txt\n\n/*\n// --- FUNCIONALIDAD EXTRA ---\n\n// TO FIX: 1. Cuando se crea un nuevo producto desde un dialogo.\n//         2. Recomendar no utilizar el dialogo para crear productos, sino a pantalla completa para acceder a todas las funciones\n//            Se puede desactivar el dialogo personalizando el formulario correspondiente.\n// frappe.ui.form.on(\"Item\", {\n//     // VERIFICACION AL GUARDAR DOCUMENTO: Cuando se guardar el documento, verificara en la tabla hija 'uoms'\n//     // que exista un elemento default, si no existe un elemento default no permitira guardar el documento.\n//     validate: function (frm, cdt, cdn) {\n//         if (cur_frm.doc.uoms === undefined) {\n//             frappe.msgprint('Por favor selecciona una unidad de medida default para Sales Analitycs 2');\n//             frm.disable_save();\n//         } else {\n//             let uncheck = 0;\n//             frm.doc.uoms.forEach((uom_element, index) => {\n//                 if (uom_element.revelare_default_uom_sales_analytics_2) {\n//                     frm.enable_save();\n//                     uncheck++;\n//                 }\n//             });\n//             if (uncheck < 1) {\n//                 // FIX MESSAGE\n//                 frappe.msgprint('Por favor selecciona una unidad de medida default para Sales Analitycs');\n//                 frm.disable_save();\n//             }\n//         }\n//     }\n// });\n*/\n\n// UOM Conversion Detail TABLA HIJA DE Item\nfrappe.ui.form.on('UOM Conversion Detail', {\n    // Ejecuta la funcion cuando exista una interaccion con 'revelare_default_uom_sales_analytics_2'\n    revelare_default_uom_sales_analytics_2: function (frm, cdt, cdn) {\n        let check = 0;\n        // Recorre los elementos de la tabla hija ubicandose exactamente en la fila en que \n        // estemos trabajando, esto para obtener datos exactos.\n        frm.doc.uoms.forEach((uom_row_i, index_i) => {\n            if (uom_row_i.name == cdn) {\n                (uom_row_i.revelare_default_uom_sales_analytics_2) ? frm.enable_save() : console.log('unckecked');\n                // FORMA 2! RECOMENDADA ES5 > :)\n                // Unicamente va permitir que exista un elemento seleccionado\n                frm.doc.uoms.forEach((uom_row, indice) => {\n                    if (uom_row.revelare_default_uom_sales_analytics_2) {\n                        check++;\n                        if (check > 1) {\n                            frappe.msgprint('Solamente debe haber un elemento seleccionado');\n                            frm.doc.uoms[index_i].revelare_default_uom_sales_analytics_2 = 0;\n                            refresh_field('uoms');\n                            // console.log(uom_row_i.revelare_default_uom_sales_analytics_2)\n                        }\n                    }\n                });\n            }\n        });\n    }\n});\n\n// Validando CustomField Journal Entry Account\nfrappe.ui.form.on('Journal Entry', {\n    setup : function(frm){\n        cur_frm.set_query(\"direct_cash_flow_component\", \"accounts\", function () {\n            return {\n                \"filters\": {\n                    \"is_group\": 0\n                }\n            };\n        });\n    }\n});\n\n// Funcionalidad sobre tabla hija en Journal Entry\nfrappe.ui.form.on('Journal Entry Account', {\n    account : function(frm, cdt,cdn){\n        //Creamos objeto de la tabla hija\n        let row = frappe.get_doc(cdt, cdn);\n        // Validamos con un booleano si desde python el tipo de cuenta es 'cash' o 'bank'\n        frappe.call({\n            method: 'revelare.data.get_type_account',\n            args: {\n                account_name: row.account\n            },\n            callback: (r) => {\n                console.log(r.message)\n                if(r.message == true){\n                    // Hacemos visible el campo direct_cash_flow_component\n                    var df=frappe.meta.get_docfield(\"Journal Entry Account\", \"direct_cash_flow_component\",frm.doc.name);\n                    df.hidden=0;\n                    frm.refresh_fields();\n                } else {\n                    // Ocultamos el campo direct_cash_flow_component\n                    var df=frappe.meta.get_docfield(\"Journal Entry Account\", \"direct_cash_flow_component\",frm.doc.name);\n                    df.hidden=1;\n                    row.direct_cash_flow_component = ''\n                    frm.refresh_fields();\n                }\n            }\n        })\n    }, \n    debit_in_account_currency : function(frm,cdt,cdn){\n        // Si debito es => 0 Filtrar componenete, mostrar solo Inflow\n        /*\n        let row = frappe.get_doc(cdt, cdn);\n        if(row.debit_in_account_currency > 0){\n            cur_frm.set_query(\"direct_cash_flow_component\", \"accounts\", function () {\n                return {\n                    \"filters\": {\n                        \"is_group\": 0,\n                        \"cash_effect\":\"Inflow\"\n                    }\n                };\n            });\n        }*/\n        frm.refresh();\n    },\n    credit_in_account_currency : function(frm,cdt,cdn){\n        // Si credito es => 0 Filtrar componenete, mostrar solo Outflow\n        /*\n        let row = frappe.get_doc(cdt, cdn);\n        if(row.credit_in_account_currency > 0){\n            if(row.direct_cash_flow_component){\n                cur_frm.set_query(\"direct_cash_flow_component\", \"accounts\", function () {\n                    return {\n                        \"filters\": {\n                            \"is_group\": 0,\n                            \"cash_effect\":\"Outflow\"\n                        }\n                    };\n                });\n                console.log(\"Vamos a refrescar los campos\")\n                frm.refresh_fields();\n            } else {\n                console.log(\"No existe el Campo direct_cash_flow_component\")\n            }\n        \n        }*/\n        frm.refresh();\n    }\n});\n\n\n// Validando customfield de Payment Entry\nfrappe.ui.form.on(\"Payment Entry\", {\n    setup: function(frm) {\n        frm.set_query(\"direct_cash_flow_component\", function() {\n            return {\n            filters: [\n                [\"Direct Cash Flow Component\",\"is_group\", \"in\", [\"0\"]]\n            ]\n            }\n        });\n    }\n});"],"names":["frappe","ui","form","on","revelare_default_uom_sales_analytics_2","frm","cdt","cdn","let","check","doc","uoms","forEach","uom_row_i","index_i","name","enable_save","console","log","uom_row","indice","msgprint","refresh_field","setup","cur_frm","set_query","filters","is_group","account","row","get_doc","call","method","args","account_name","callback","r","message","meta","get_docfield","hidden","refresh_fields","direct_cash_flow_component","debit_in_account_currency","refresh","credit_in_account_currency"],"mappings":"yBAmCAA,OAAOC,GAAGC,KAAKC,GAAG,wBAAyB,CAEvCC,uCAAwC,SAAUC,EAAKC,EAAKC,GACxDC,IAAIC,EAAQ,EAGZJ,EAAIK,IAAIC,KAAKC,iBAASC,EAAWC,GACzBD,EAAUE,MAAQR,IACjBM,EAAgD,uCAAIR,EAAIW,cAAgBC,QAAQC,IAAI,aAGrFb,EAAIK,IAAIC,KAAKC,iBAASO,EAASC,GACvBD,EAAQf,0CACRK,EACY,IACRT,OAAOqB,SAAS,iDAChBhB,EAAIK,IAAIC,KAAKG,GAASV,uCAAyC,EAC/DkB,cAAc,iBAW1CtB,OAAOC,GAAGC,KAAKC,GAAG,gBAAiB,CAC/BoB,MAAQ,SAASlB,GACbmB,QAAQC,UAAU,6BAA8B,WAAY,WACxD,MAAO,CACHC,QAAW,CACPC,SAAY,SAQhC3B,OAAOC,GAAGC,KAAKC,GAAG,wBAAyB,CACvCyB,QAAU,SAASvB,EAAKC,EAAIC,GAExBC,IAAIqB,EAAM7B,OAAO8B,QAAQxB,EAAKC,GAE9BP,OAAO+B,KAAK,CACRC,OAAQ,iCACRC,KAAM,CACFC,aAAcL,EAAID,SAEtBO,kBAAWC,IACPnB,QAAQC,IAAIkB,EAAEC,SACE,GAAbD,EAAEC,UAEMrC,OAAOsC,KAAKC,aAAa,wBAAyB,6BAA6BlC,EAAIK,IAAIK,MAC3FyB,OAAO,EACVnC,EAAIoC,mBAGGzC,OAAOsC,KAAKC,aAAa,wBAAyB,6BAA6BlC,EAAIK,IAAIK,MAC3FyB,OAAO,EACVX,EAAIa,2BAA6B,GACjCrC,EAAIoC,sBAKpBE,0BAA4B,SAAStC,EAAIC,EAAIC,GAczCF,EAAIuC,WAERC,2BAA6B,SAASxC,EAAIC,EAAIC,GAqB1CF,EAAIuC,aAMZ5C,OAAOC,GAAGC,KAAKC,GAAG,gBAAiB,CAC/BoB,MAAO,SAASlB,GACZA,EAAIoB,UAAU,6BAA8B,WACxC,MAAO,CACPC,QAAS,CACL,CAAC,6BAA6B,WAAY,KAAM,CAAC"}
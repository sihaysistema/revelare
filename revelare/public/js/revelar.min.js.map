{"version":3,"file":"revelar.min.js","sources":["../../../../apps/revelare/revelare/public/js/revelar.js"],"sourcesContent":["// Copyright (c) 2018, Si Hay Sistema (SHS) and contributors\n// For license information, please see license.txt\n\n/*\n// --- FUNCIONALIDAD EXTRA ---\n\n// TO FIX: 1. Cuando se crea un nuevo producto desde un dialogo.\n//         2. Recomendar no utilizar el dialogo para crear productos, sino a pantalla completa para acceder a todas las funciones\n//            Se puede desactivar el dialogo personalizando el formulario correspondiente.\n// frappe.ui.form.on(\"Item\", {\n//     // VERIFICACION AL GUARDAR DOCUMENTO: Cuando se guardar el documento, verificara en la tabla hija 'uoms'\n//     // que exista un elemento default, si no existe un elemento default no permitira guardar el documento.\n//     validate: function (frm, cdt, cdn) {\n//         if (cur_frm.doc.uoms === undefined) {\n//             frappe.msgprint('Por favor selecciona una unidad de medida default para Sales Analitycs 2');\n//             frm.disable_save();\n//         } else {\n//             let uncheck = 0;\n//             frm.doc.uoms.forEach((uom_element, index) => {\n//                 if (uom_element.revelare_default_uom_sales_analytics_2) {\n//                     frm.enable_save();\n//                     uncheck++;\n//                 }\n//             });\n//             if (uncheck < 1) {\n//                 // FIX MESSAGE\n//                 frappe.msgprint('Por favor selecciona una unidad de medida default para Sales Analitycs');\n//                 frm.disable_save();\n//             }\n//         }\n//     }\n// });\n*/\n\n// UOM Conversion Detail TABLA HIJA DE Item\nfrappe.ui.form.on('UOM Conversion Detail', {\n    // Ejecuta la funcion cuando exista una interaccion con 'revelare_default_uom_sales_analytics_2'\n    revelare_default_uom_sales_analytics_2: function (frm, cdt, cdn) {\n        let check = 0;\n        // Recorre los elementos de la tabla hija ubicandose exactamente en la fila en que \n        // estemos trabajando, esto para obtener datos exactos.\n        frm.doc.uoms.forEach((uom_row_i, index_i) => {\n            if (uom_row_i.name == cdn) {\n                (uom_row_i.revelare_default_uom_sales_analytics_2) ? frm.enable_save() : console.log('unckecked');\n                // FORMA 2! RECOMENDADA ES5 > :)\n                // Unicamente va permitir que exista un elemento seleccionado\n                frm.doc.uoms.forEach((uom_row, indice) => {\n                    if (uom_row.revelare_default_uom_sales_analytics_2) {\n                        check++;\n                        if (check > 1) {\n                            frappe.msgprint('Solamente debe haber un elemento seleccionado');\n                            frm.doc.uoms[index_i].revelare_default_uom_sales_analytics_2 = 0;\n                            refresh_field('uoms');\n                            // console.log(uom_row_i.revelare_default_uom_sales_analytics_2)\n                        }\n                    }\n                });\n            }\n        });\n    }\n});\n\n// Validando CustomField Journal Entry Account\nfrappe.ui.form.on('Journal Entry', {\n    setup : function(frm){\n        cur_frm.set_query(\"inflow_component\", \"accounts\", function () {\n            return {\n                \"filters\": {\n                    \"is_group\": 0,\n                    \"cash_effect\":\"Inflow\"\n                }\n            };\n        });\n        cur_frm.set_query(\"outflow_component\", \"accounts\", function () {\n            return {\n                \"filters\": {\n                    \"is_group\": 0,\n                    \"cash_effect\":\"Outflow\"\n                }\n            };\n        });\n    },\n});\n\n// Funcionalidad sobre tabla hija en Journal Entry\nfrappe.ui.form.on('Journal Entry Account', {\n    account : function(frm, cdt,cdn){\n        validate_cash_flow_component(frm, cdt, cdn);\n    },\n    party_type : function(frm, cdt,cdn){\n        let row = frappe.get_doc(cdt, cdn);\n        if(row.party_type == 'Customer'){\n            // Dandode el valor al campo respecto a Party Type\n            cur_frm.set_value(row.inflow_component,'Receipts from Customers');\n        }\n        frm.refresh();\n    }, \n    debit_in_account_currency : function(frm,cdt,cdn){\n        validate_cash_flow_component(frm, cdt, cdn, field='debit');\n    },\n    credit_in_account_currency : function(frm,cdt,cdn){\n        validate_cash_flow_component(frm, cdt, cdn, field='credit');\n    },\n    form_render : function(frm, cdt, cdn){\n        validate_cash_flow_component(frm, cdt, cdn);\n    }\n});\n\nfunction validate_cash_flow_component(frm, cdt, cdn, field=''){\n    //Creamos objeto de la tabla hija\n    let row = frappe.get_doc(cdt, cdn);\n    // Validamos con un booleano si desde python el tipo de cuenta es 'cash' o 'bank'\n    frappe.call({\n        method: 'revelare.data.get_type_account',\n        args: {\n            account_name: row.account\n        },\n        callback: (r) => {\n            console.log(r.message)\n            if(r.message == true){\n                // En el campo debito, si el debito es = 0 y el credito es > 0\n                if(row.credit_in_account_currency > 0 && (row.debit_in_account_currency == 0 || row.debit_in_account_currency == undefined)){\n                    // Hacemos visible el campo outflow_component\n                    let df=frappe.meta.get_docfield(\"Journal Entry Account\", \"outflow_component\",frm.doc.name);\n                    df.hidden=0;\n        \n                    // Y ocultamos el campo inflow_component\n                    let df2=frappe.meta.get_docfield(\"Journal Entry Account\", \"inflow_component\",frm.doc.name);\n                    df2.hidden=1;\n                    row.debit_in_account_currency = 0\n                // En el campo debito, si el debito es = 0 y el credito es > 0\n                }else if(row.debit_in_account_currency > 0 && (row.credit_in_account_currency == 0 || row.credit_in_account_currency == undefined)){\n                    // Hacemos visible el campo inflow_component\n                    let df=frappe.meta.get_docfield(\"Journal Entry Account\", \"inflow_component\",frm.doc.name);\n                    df.hidden=0;\n        \n                    // Y ocultamos el campo outflow_component\n                    let df2=frappe.meta.get_docfield(\"Journal Entry Account\", \"outflow_component\",frm.doc.name);\n                    df2.hidden=1;\n                    row.credit_in_account_currency = 0\n                } else if(row.debit_in_account_currency > 0 && row.credit_in_account_currency > 0){\n                    // Si estamos en el campo de credit ocultamos el inflow\n                    if (field == 'credit'){\n                        let df=frappe.meta.get_docfield(\"Journal Entry Account\", \"inflow_component\",frm.doc.name);\n                        df.hidden=1;\n                        let df2=frappe.meta.get_docfield(\"Journal Entry Account\", \"outflow_component\",frm.doc.name);\n                        df2.hidden=0;\n                        row.debit_in_account_currency = 0\n                    // Si estamos en el campo de debit ocultamos el outflow\n                    } else if(field == 'debit'){\n                        let df=frappe.meta.get_docfield(\"Journal Entry Account\", \"inflow_component\",frm.doc.name);\n                        df.hidden=0;\n                        let df2=frappe.meta.get_docfield(\"Journal Entry Account\", \"outflow_component\",frm.doc.name);\n                        df2.hidden=1;\n                        row.credit_in_account_currency = 0\n                    }\n                } else if((row.credit_in_account_currency == undefined) &&(row.debit_in_account_currency == undefined)) {\n                    // Hacemos visible el campo inflow_component\n                    let df=frappe.meta.get_docfield(\"Journal Entry Account\", \"inflow_component\",frm.doc.name);\n                    df.hidden=0;\n\n                    // Y ocultamos el campo outflow_component\n                    let df2=frappe.meta.get_docfield(\"Journal Entry Account\", \"outflow_component\",frm.doc.name);\n                    df2.hidden=1;\n                } else{\n                    // Ocultamos los dos campos\n                    let df=frappe.meta.get_docfield(\"Journal Entry Account\", \"inflow_component\",frm.doc.name);\n                    df.hidden=1;\n\n                    let df2=frappe.meta.get_docfield(\"Journal Entry Account\", \"outflow_component\",frm.doc.name);\n                    df2.hidden=1;\n                }\n                frm.refresh();\n            } else {\n                // Ocultamos el campo inflow_component\n                let df=frappe.meta.get_docfield(\"Journal Entry Account\", \"inflow_component\",frm.doc.name);\n                df.hidden=1;\n\n                // Ocultamos el campo direct_cash_flow_component\n                let df2=frappe.meta.get_docfield(\"Journal Entry Account\", \"outflow_component\",frm.doc.name);\n                df2.hidden=1;\n\n                row.inflow_component = ''\n                row.outflow_component = ''\n                frm.refresh_fields();\n            }\n        }\n    });\n}\n\n\n// Validando customfield de Payment Entry\nfrappe.ui.form.on(\"Payment Entry\", {\n    setup: function(frm) {\n        cur_frm.set_query(\"inflow_component\", function () {\n            return {\n                \"filters\": {\n                    \"is_group\": 0,\n                    \"cash_effect\":\"Inflow\"\n                }\n            };\n        });\n        cur_frm.set_query(\"outflow_component\", function () {\n            return {\n                \"filters\": {\n                    \"is_group\": 0,\n                    \"cash_effect\":\"Outflow\"\n                }\n            };\n        });\n    },\n    refresh :function(frm){\n        // Validamos los campos al momento de que cargue el documento\n        if(cur_frm.doc.payment_type == 'Pay'){\n            // Al ser pago, habilitamos el campo salida de flujo \"outflow\"\n            let df=frappe.meta.get_docfield(\"Payment Entry\", \"outflow_component\",frm.doc.name);\n            df.hidden = 0\n\n            // Al ser pago, deshabilitamos el campo entra de flujo \"inflow\"\n            let df2=frappe.meta.get_docfield(\"Payment Entry\", \"inflow_component\",frm.doc.name);\n            df2.hidden = 1\n        } else if(cur_frm.doc.payment_type == 'Receive'){\n            // Al ser pago, deshabilitamos el campo salida de flujo \"outflow\"\n            let df=frappe.meta.get_docfield(\"Payment Entry\", \"outflow_component\",frm.doc.name);\n            df.hidden = 1\n\n            // Al ser entrada, habilitamos el campo entra de flujo \"inflow\"\n            let df2=frappe.meta.get_docfield(\"Payment Entry\", \"inflow_component\",frm.doc.name);\n            df2.hidden = 0\n        } else {\n            // Al ser transferencia, deshabilitamos los dos campos\n            let df=frappe.meta.get_docfield(\"Payment Entry\", \"outflow_component\",frm.doc.name);\n            df.hidden = 1\n\n            let df2=frappe.meta.get_docfield(\"Payment Entry\", \"inflow_component\",frm.doc.name);\n            df2.hidden = 1\n        }\n    },\n    payment_type : function(frm){\n        console.log(frm.doc.payment_type)\n        if(cur_frm.doc.payment_type == 'Pay'){\n            // Al ser pago, habilitamos el campo salida de flujo \"outflow\"\n            let df=frappe.meta.get_docfield(\"Payment Entry\", \"outflow_component\",frm.doc.name);\n            df.hidden = 0\n\n            // Al ser pago, deshabilitamos el campo entra de flujo \"inflow\"\n            let df2=frappe.meta.get_docfield(\"Payment Entry\", \"inflow_component\",frm.doc.name);\n            df2.hidden = 1\n        } else if(cur_frm.doc.payment_type == 'Receive'){\n            // Al ser pago, deshabilitamos el campo salida de flujo \"outflow\"\n            let df=frappe.meta.get_docfield(\"Payment Entry\", \"outflow_component\",frm.doc.name);\n            df.hidden = 1\n\n            // Al ser entrada, habilitamos el campo entra de flujo \"inflow\"\n            let df2=frappe.meta.get_docfield(\"Payment Entry\", \"inflow_component\",frm.doc.name);\n            df2.hidden = 0\n            console.log('Es Una entrada')\n        } else {\n            // Al ser transferencia, deshabilitamos los dos campos\n            let df=frappe.meta.get_docfield(\"Payment Entry\", \"outflow_component\",frm.doc.name);\n            df.hidden = 1\n\n            let df2=frappe.meta.get_docfield(\"Payment Entry\", \"inflow_component\",frm.doc.name);\n            df2.hidden = 1\n\n        }\n    }\n});\n\n// Función para Direct Cash\nfunction open_two_tabs(from_date){\n    account = '1.1.01.02.22 - PAYPAL - ACC-GT'\n    start_date = '2021-02-01'\n    end_date = '2021-03-31'\n\n    window.open(`#List/Journal%20Entry/Report?account=${account}&posting_date=${start_date},${end_date}`);\n    window.open(\"#List/Payment%20Entry/Report\");\n    return true;\n};\n\n// Función para Detail Cash Flow\nfunction open_one_tab(name, type){\n    console.log('Tipo es: ', type);\n    console.log('Nombre es: ', name);\n    if (type === 'journal_entry'){\n        window.open(`#Form/Journal%20Entry/${name}`);\n    } else if(type === 'payment_entry'){\n        window.open(`#Form/Payment%20Entry/${name}`);\n    }\n    return true;\n};"],"names":["validate_cash_flow_component","frm","cdt","cdn","field","let","row","frappe","get_doc","call","method","args","account_name","account","callback","r","console","log","message","credit_in_account_currency","debit_in_account_currency","undefined","meta","get_docfield","doc","name","hidden","refresh","inflow_component","outflow_component","refresh_fields","ui","form","on","revelare_default_uom_sales_analytics_2","check","uoms","forEach","uom_row_i","index_i","enable_save","uom_row","indice","msgprint","refresh_field","setup","cur_frm","set_query","filters","is_group","cash_effect","party_type","set_value","form_render","payment_type"],"mappings":"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"}